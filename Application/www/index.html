<!DOCTYPE html>
<html>
<!--
#
# Licensed to the Apache Software Foundation (ASF) under one
# or more contributor license agreements.  See the NOTICE file
# distributed with this work for additional information
# regarding copyright ownership.  The ASF licenses this file
# to you under the Apache License, Version 2.0 (the
# "License"); you may not use this file except in compliance
# with the License.  You may obtain a copy of the License at
# 
# http://www.apache.org/licenses/LICENSE-2.0
# 
# Unless required by applicable law or agreed to in writing,
# software distributed under the License is distributed on an
# "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
#  KIND, either express or implied.  See the License for the
# specific language governing permissions and limitations
# under the License.
#
-->
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
        <meta name = "format-detection" content = "telephone=no"/>
        <meta name="viewport" content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width;" />
        <link rel="stylesheet" type="text/css" href="css/index.css" /> <!-- 2048-by-1536 resolution at 264 pixels per inch (ppi) -->
        <link rel="stylesheet" type="text/css" href="css/jquery.percentageloader-0.1.css" />
        <title>LemonAid</title>
    </head>
    <body>
        <div class="app">
            <div id="statusBar">
            	<div id="connectionCheck">
            		<label id="netCon" class="statusIcon"></label>
            		<label id="dbCon" class="statusIcon"></label>
            		<label id="socketConn" class="statusIcon"></label>
            	</div> 	
            </div>
            
            <div id="launchPage" class="appPage">
            	<div id="launchIcon">
            			
            	</div>
            	<div id="options">
            		<button id="disconnectConn">Disconnect</button>
            		<div id="myDiv" ></div>
            		<canvas id="myCanvas" width="400" height="200"></canvas>
            		<label id="speedValue"></label>
            	</div>
            </div>
            
            <div id="navBar">
            	<div id="navItems">
            		
            	</div>
            </div>
            
        </div>
        <script type="text/javascript" src="js/jquery.min.js"></script>
        <script type="text/javascript" src="cordova-2.0.0.js"></script>
        <script type="text/javascript" src="js/index.js"></script>
        <script type="text/javascript" src="js/websocket.js"></script>
        <script type="text/javascript" src="js/gauge.min.js"></script>
        <script type="text/javascript" src="js/jquery.percentageloader-0.1.js"></script>
        <script type="text/javascript" src="http://localhost:8080/socket.io/socket.io.js"></script>
        <script type="text/javascript">
            document.addEventListener('deviceready', onDeviceReady, false);
            var isNetConnected = false;
            var isDbConnected = false;
            var isSocketConnected = false;
            var socket = -1;
            
            
            //gauge
		  	var opts = {
				lines: 12, // The number of lines to draw
		  		angle: 0, // The length of each line
			    lineWidth: 0.28, // The line thickness
			    pointer: {
				    length: 0.7, // The radius of the inner circle
				    strokeWidth: 0.035, // The rotation offset
				    color: '#000000' // Fill color
			    },
		  		colorStart: '#6FADCF',   // Colors
			    colorStop: '#8FC0DA',    // just experiment with them
			    strokeColor: '#E0E0E0',   // to see which ones work best for you
			    generateGradient: true
			};
		
			var target = document.getElementById('myCanvas'); // your canvas element
			var gauge = new Gauge(target).setOptions(opts); // create sexy gauge!
			gauge.maxValue = 20; // set max gauge value
			gauge.animationSpeed = 40; // set animation speed (32 is default value)
			gauge.set(0); // set actual value
            
           
            
            
            
            /**
             *  steps to do when cordova is ready 
             */
            function onDeviceReady(){
            	console.log('device ready');
            	document.addEventListener("online", onOnline, false);
            	document.addEventListener("offline", onOffline, false);
            	
            	//checkConnection();
            	
            	//loader settings
	            var loader = $("#myDiv").percentageLoader();
	            
            	
            	socket = io.connect('http://localhost:8080');
            	socket.emit('my other event', { hello: 2 });
            	
            	socket.on('news', function (data) {
            		gauge.set(data.hello);
            		
            		//loader.setValue(data.hello + 'kmph');
            		loader.setProgress(data.hello/20);
            		
            		$('#speedValue').text(data.hello);
	            
            		$('#socketConn').text('Socket Connected ' + data.hello);
					isSocketConnected = true;  
		  		});
		  		
            }
                    
            /**
             *  check connection 
             */
            function checkConnection(){
            	console.log('connection check');
            	var networkState = navigator.network.connection.type;

			    var states = {};
			    states[Connection.UNKNOWN]  = 'Unknown connection';
			    states[Connection.ETHERNET] = 'Ethernet connection';
			    states[Connection.WIFI]     = 'WiFi connection';
			    states[Connection.CELL_2G]  = 'Cell 2G connection';
			    states[Connection.CELL_3G]  = 'Cell 3G connection';
			    states[Connection.CELL_4G]  = 'Cell 4G connection';
			    states[Connection.NONE]     = 'No network connection';
			
			    alert('Connection type: ' + states[networkState]);
			    
			    if(states[Connection.WIFI] == 'WiFi connection'){
			    	$('#netCon').text('WiFi connected');
			    	isNetConnected = true;
			    }
            }
            
            /**
             *  handle online event
             */
            function onOnline(){
            	$('#netCon').text('WiFi connected');
			    isNetConnected = true;
            }
            
            /**
             *  handle offline event
             */
            function onOffline(){
            	$('#netCon').text('WiFi disconnected');
			    isNetConnected = false;
            }
            
            /**
			 *  disconnect the socket
			 */
			$('#disconnectConn').click(function(){
				//alert('Disconnect Socket');
				
				navigator.notification.alert(
				    "Disconnect Socket",
				    callBackFunctionB, // Specify a function to be called 
				    'LemonAid',
				    "OK"
				);
				
				socket.disconnect();
				$('#socketConn').text('Socket disonnected');
				isSocketConnected = false;
			});
			
			/**
			 *  callback for alert 
			 */
			function callBackFunctionB(){
			    console.log('Socket Disconnected - ok');
			}
			
            
            
        </script>
    </body>
</html>
