<!DOCTYPE html>
<html>
<!--
#
# Licensed to the Apache Software Foundation (ASF) under one
# or more contributor license agreements.  See the NOTICE file
# distributed with this work for additional information
# regarding copyright ownership.  The ASF licenses this file
# to you under the Apache License, Version 2.0 (the
# "License"); you may not use this file except in compliance
# with the License.  You may obtain a copy of the License at
# 
# http://www.apache.org/licenses/LICENSE-2.0
# 
# Unless required by applicable law or agreed to in writing,
# software distributed under the License is distributed on an
# "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
#  KIND, either express or implied.  See the License for the
# specific language governing permissions and limitations
# under the License.
#
-->
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
        <meta name = "format-detection" content = "telephone=no"/>
        <meta name="viewport" content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width;" />
        <link rel="stylesheet" type="text/css" href="css/index.css" /> <!-- 2048-by-1536 resolution at 264 pixels per inch (ppi) -->
        <link rel="stylesheet" type="text/css" href="css/jquery.percentageloader-0.1.css" />
        
        <link rel="stylesheet" type="text/css" href="css/kendo.mobile.all.min.css" />
        
        <title>LemonAid</title>
    </head>
    <body>
    	<div class="barBuffer" style="height: 20px;"></div>
        <div class="app">
            <div id="statusBar">
            	<div id="connectionCheck">
            		<label id="netCon" class="statusIcon"></label>
            		<label id="dbCon" class="statusIcon"></label>
            		<label id="socketConn" class="statusIcon"></label>
            	</div> 
            	<button id="disconnectConn">Disconnect</button>	
            </div>
            
            <div id="analysisPage" class="appPage">
            	 <div id="container" style="height: 550px; max-width: 800px; border: 1px solid red;"></div>
            </div>
            
           

            
            <!--<div id="navBar">
            	<div id="navItems">
            		<button id="toHome">Home</button>
            		<button id="toAnalysis">Analysis</button>
            		
            	</div>
            </div>-->
            
        </div>
        <script type="text/javascript" src="js/jquery.min.js"></script>
        <script type="text/javascript" src="cordova-2.0.0.js"></script>
        <script type="text/javascript" src="js/index.js"></script>
        <script type="text/javascript" src="js/websocket.js"></script>
        
        <script type="text/javascript" src="js/highstock.js"></script>
        <script type="text/javascript" src="js/exporting.js"></script>
        
        <script type="text/javascript" src="js/TabBar.js"></script>
       
         
        <script type="text/javascript" src="http://localhost:8080/socket.io/socket.io.js"></script>
        <!--<script type="text/javascript" src="http://192.168.1.1:8080/socket.io/socket.io.js"></script>-->
        <script type="text/javascript">
            var isNetConnected = false;
            var isDbConnected = false;
            var isSocketConnected = false;
            var socket = -1;
            
            var speedData = 0;
            
            /**
             *  steps to do when cordova is ready 
             */
            
            document.addEventListener("deviceready", function() {
    console.log("PhoneGap ready")

plugins.tabBar.createItem("dashboard", "Dashboard", "www/img/dashboardIcon.png", {
        onSelect: function() {
            //alert("dashboard tab selected")
            //selectedTabBar = "dashboard";
            window.location.href = "index.html";
        }
    })

	plugins.tabBar.createItem("analysis", "Analysis", "/www/img/analysisIcon.png", {
        onSelect: function() {
            //alert("analysis tab selected")
            //window.location.href = "analysis.html";
            //selectedTabBarItem = "analysis";
        }
    })
    
    //plugins.selectTabBarItem("analysis");
    //plugins.tabBar.show()
    
    
    
    socket = io.connect('http://localhost:8080');
            	//socket = io.connect('http://192.168.1.1:8080');
            	//socket.emit('my other event', { hello: 2 });
            	
            	socket.on('news', function (data) {
            		//gauge.set(data.hello);
            		
            		//loader.setValue(data.hello + 'kmph');
            		//loader.setProgress(data.hello/20);
            		
            		//speeder.position(data.hello);
            		//speeder.accelerate(data.hello);
					//speeder.scrollTo(data.hello*10);
					
					speedData = data.hello;
					
            		$('#socketConn').text('Socket Connected ' + data.hello);
					isSocketConnected = true;  
		  		});
            
    
    
    }, false)
              
             
             
             
                   
            /**
             *  check connection 
             */
            function checkConnection(){
            	console.log('connection check');
            	var networkState = navigator.network.connection.type;

			    var states = {};
			    states[Connection.UNKNOWN]  = 'Unknown connection';
			    states[Connection.ETHERNET] = 'Ethernet connection';
			    states[Connection.WIFI]     = 'WiFi connection';
			    states[Connection.CELL_2G]  = 'Cell 2G connection';
			    states[Connection.CELL_3G]  = 'Cell 3G connection';
			    states[Connection.CELL_4G]  = 'Cell 4G connection';
			    states[Connection.NONE]     = 'No network connection';
			
			    alert('Connection type: ' + states[networkState]);
			    
			    if(states[Connection.WIFI] == 'WiFi connection'){
			    	$('#netCon').text('WiFi connected');
			    	isNetConnected = true;
			    }
            }
            
            /**
             *  handle online event
             */
            function onOnline(){
            	$('#netCon').text('WiFi connected');
			    isNetConnected = true;
            }
            
            /**
             *  handle offline event
             */
            function onOffline(){
            	$('#netCon').text('WiFi disconnected');
			    isNetConnected = false;
            }
            
            /**
			 *  disconnect the socket
			 */
			$('#disconnectConn').click(function(){
				//alert('Disconnect Socket');
				
				navigator.notification.alert(
				    "Disconnect Socket",
				    callBackFunctionB, // Specify a function to be called 
				    'LemonAid',
				    "OK"
				);
				
				socket.disconnect();
				$('#socketConn').text('Socket disonnected');
				isSocketConnected = false;
			});
			
			/**
			 *  callback for alert 
			 */
			function callBackFunctionB(){
			    console.log('Socket Disconnected - ok');
			}
			
			
			$('#toHome').click(function(){
				window.location.href = 'index.html';
			});
            
   
   
Highcharts.theme = {
   colors: ["#DDDF0D", "#7798BF", "#55BF3B", "#DF5353", "#aaeeee", "#ff0066", "#eeaaee",
      "#55BF3B", "#DF5353", "#7798BF", "#aaeeee"],
   chart: {
      backgroundColor: {
         linearGradient: [0, 0, 0, 400],
         stops: [
            [0, 'rgb(96, 96, 96)'],
            [1, 'rgb(16, 16, 16)']
         ]
      },
      borderWidth: 0,
      borderRadius: 15,
      plotBackgroundColor: null,
      plotShadow: false,
      plotBorderWidth: 0
   },
   title: {
      style: {
         color: '#FFF',
         font: '16px Lucida Grande, Lucida Sans Unicode, Verdana, Arial, Helvetica, sans-serif'
      }
   },
   subtitle: {
      style: {
         color: '#DDD',
         font: '12px Lucida Grande, Lucida Sans Unicode, Verdana, Arial, Helvetica, sans-serif'
      }
   },
   xAxis: {
      gridLineWidth: 0,
      lineColor: '#999',
      tickColor: '#999',
      labels: {
         style: {
            color: '#999',
            fontWeight: 'bold'
         }
      },
      title: {
         style: {
            color: '#AAA',
            font: 'bold 12px Lucida Grande, Lucida Sans Unicode, Verdana, Arial, Helvetica, sans-serif'
         }
      }
   },
   yAxis: {
      alternateGridColor: null,
      minorTickInterval: null,
      gridLineColor: 'rgba(255, 255, 255, .1)',
      lineWidth: 0,
      tickWidth: 0,
      labels: {
         style: {
            color: '#999',
            fontWeight: 'bold'
         }
      },
      title: {
         style: {
            color: '#AAA',
            font: 'bold 12px Lucida Grande, Lucida Sans Unicode, Verdana, Arial, Helvetica, sans-serif'
         }
      }
   },
   legend: {
      itemStyle: {
         color: '#CCC'
      },
      itemHoverStyle: {
         color: '#FFF'
      },
      itemHiddenStyle: {
         color: '#333'
      }
   },
   labels: {
      style: {
         color: '#CCC'
      }
   },
   tooltip: {
      backgroundColor: {
         linearGradient: [0, 0, 0, 50],
         stops: [
            [0, 'rgba(96, 96, 96, .8)'],
            [1, 'rgba(16, 16, 16, .8)']
         ]
      },
      borderWidth: 0,
      style: {
         color: '#FFF'
      }
   },


   plotOptions: {
      line: {
         dataLabels: {
            color: '#CCC'
         },
         marker: {
            lineColor: '#333'
         }
      },
      spline: {
         marker: {
            lineColor: '#333'
         }
      },
      scatter: {
         marker: {
            lineColor: '#333'
         }
      },
      candlestick: {
         lineColor: 'white'
      }
   },

   toolbar: {
      itemStyle: {
         color: '#CCC'
      }
   },

   navigation: {
      buttonOptions: {
         backgroundColor: {
            linearGradient: [0, 0, 0, 20],
            stops: [
               [0.4, '#606060'],
               [0.6, '#333333']
            ]
         },
         borderColor: '#000000',
         symbolStroke: '#C0C0C0',
         hoverSymbolStroke: '#FFFFFF'
      }
   },

   exporting: {
      buttons: {
         exportButton: {
            symbolFill: '#55BE3B'
         },
         printButton: {
            symbolFill: '#7797BE'
         }
      }
   },

   // scroll charts
   rangeSelector: {
      buttonTheme: {
         fill: {
            linearGradient: [0, 0, 0, 20],
            stops: [
               [0.4, '#888'],
               [0.6, '#555']
            ]
         },
         stroke: '#000000',
         style: {
            color: '#CCC',
            fontWeight: 'bold'
         },
         states: {
            hover: {
               fill: {
                  linearGradient: [0, 0, 0, 20],
                  stops: [
                     [0.4, '#BBB'],
                     [0.6, '#888']
                  ]
               },
               stroke: '#000000',
               style: {
                  color: 'white'
               }
            },
            select: {
               fill: {
                  linearGradient: [0, 0, 0, 20],
                  stops: [
                     [0.1, '#000'],
                     [0.3, '#333']
                  ]
               },
               stroke: '#000000',
               style: {
                  color: 'yellow'
               }
            }
         }
      },
      inputStyle: {
         backgroundColor: '#333',
         color: 'silver'
      },
      labelStyle: {
         color: 'silver'
      }
   },

   navigator: {
      handles: {
         backgroundColor: '#666',
         borderColor: '#AAA'
      },
      outlineColor: '#CCC',
      maskFill: 'rgba(16, 16, 16, 0.5)',
      series: {
         color: '#7798BF',
         lineColor: '#A6C7ED'
      }
   },

   scrollbar: {
      barBackgroundColor: {
            linearGradient: [0, 0, 0, 20],
            stops: [
               [0.4, '#888'],
               [0.6, '#555']
            ]
         },
      barBorderColor: '#CCC',
      buttonArrowColor: '#CCC',
      buttonBackgroundColor: {
            linearGradient: [0, 0, 0, 20],
            stops: [
               [0.4, '#888'],
               [0.6, '#555']
            ]
         },
      buttonBorderColor: '#CCC',
      rifleColor: '#FFF',
      trackBackgroundColor: {
         linearGradient: [0, 0, 0, 10],
         stops: [
            [0, '#000'],
            [1, '#333']
         ]
      },
      trackBorderColor: '#666'
   },

   // special colors for some of the demo examples
   legendBackgroundColor: 'rgba(48, 48, 48, 0.8)',
   legendBackgroundColorSolid: 'rgb(70, 70, 70)',
   dataLabelsColor: '#444',
   textColor: '#E0E0E0',
   maskColor: 'rgba(255,255,255,0.3)'
};

// Apply the theme
var highchartsOptions = Highcharts.setOptions(Highcharts.theme);   
            

            
// CHART            			
$(function() {
    
    Highcharts.setOptions({
        global : {
            useUTC : false
        }
    });
    

		// Create the chart
	window.chart = new Highcharts.StockChart({
			chart : {
				renderTo : 'container',
				backgroundColor : '#000000',
				events : {
					
					load : function() {

						// set up the updating of the chart each second
						var series = this.series[0];
						var seriesrpm = this.series[1];   
						setInterval(function() {
							var x = (new Date()).getTime(), // current time
							y = speedData;
							//data.push([x, y]);
							console.log('Data: '+x + '     '+ y);
							series.addPoint([x, y], true, true);
							seriesrpm.addPoint([x, y-20], true, true);
						}, 700);
					}
				},
				style : {
					fontFamily : 'sans serif',
					fontSize : '12px'
				}
			},

			// array of colors for multiple series
			colors: [
				'#4572A7', 
				'#AA4643', 
				'#89A54E', 
				'#80699B', 
				'#3D96AE', 
				'#DB843D', 
				'#92A8CD', 
				'#A47D7C', 
				'#B5CA92'
			],
			
			// credits at the bottom of the chart
			credits : {
				enabled : false
			},
			
			rangeSelector : {
				enabled : false,
				inputEnabled : false
			},
			
			scrollbar : {
				enabled : false
			},
			
			// title of the chart
			title : {
				text : 'Live random data'
			},

			// exporting the image
			exporting : {
				enabled : false
			},

			// width of the lines
			plotOptions : {
				line : {
					lineWidth : 2
				}
			},
			
			xAxis : {
				gridLineColor : '#000000',
				type : 'datetime'
			},
			
			yAxis : {
				gridLineColor : '#000000'
			},
			yAxis: [{
		        title: {
		            text: 'Speed'
		        },
		        height: 200,
		        lineWidth : 2
		        
		    }, {
		        title: {
		            text: 'RPM'
		        },
		        top : 300,
		        height : 100,
		        offset : 0,
		        lineWidth : 2
		    }],
		    
			
			series : [{
				name : 'Speed',
				data : (function() {
					// generate an array of random data
					var data = [], time = (new Date()).getTime(), i;
					
						

					for ( i = -10; i <= 0; i++) {
						data.push([time + i * 1000, Math.round(Math.random() * 100)]);
					}
					return data;
				})()
			}, {
				name : 'Rpm',
				yAxis: 1,
				data : (function() {
					// generate an array of random data
					var datarpm = [], time = (new Date()).getTime(), i;
					
						

					for ( i = -10; i <= 0; i++) {
						datarpm.push([time + i * 1000, Math.round(Math.random() * 100)]);
					}
					return datarpm;
				})()
			}
			
			]
		});

});
            
            
            
        </script>
    </body>
</html>
